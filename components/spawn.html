<link rel="import" href="web-processes.html">

<script>
	webProcesses.spawn = function (fn) {
		// initialize
		fn();

		var mailbox = [];

		return {
			send: function (message) {
				mailbox.push(message);

				fn(message);

				return message;
			},
			flush: function () {
				return mailbox;
			}
		};
	};
</script>